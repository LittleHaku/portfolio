---
import LinkInline from "./LinkInline.astro"
import TechPill from "./TechPill.astro"

interface Props {
  title: string
  company: string
  description?: string
  highlights?: Array<string | { text: string; href?: string; linkLabel?: string }>
  link?: string
  date: string
  techs?: string[]
}

const { title, company, description = "", highlights = [], link, date, techs = [] } = Astro.props
const normalizedHighlights = highlights.map((highlight) =>
  typeof highlight === "string" ? { text: highlight } : highlight,
)
---

<div
  class="relative mx-12 pb-12 grid
         before:absolute before:left-[-35px] before:block before:h-full
         before:border-l before:border-zinc-200/80
         dark:before:border-zinc-700/40
         md:grid-cols-5 md:gap-10 md:space-x-4"
>
  <div class="relative pb-12 md:col-span-2">
    <div class="sticky top-0">
      <span
        class="absolute -left-[42px] top-1/2 -translate-y-1/2
               inline-flex h-3.5 w-3.5 rounded-full
               bg-zinc-900 dark:bg-zinc-100
               ring-4 ring-white dark:ring-zinc-900/60"
      ></span>

      <h3 class="font-serif text-2xl tracking-tight text-zinc-900 dark:text-zinc-50">
        {title}
      </h3>
      <h4 class="mt-1 text-sm uppercase tracking-[0.12em] text-zinc-500 dark:text-zinc-400">
        {company}
      </h4>
      <time class="mt-2 block text-xs text-zinc-400 dark:text-zinc-500">
        {date}
      </time>
    </div>
  </div>

  <div class="relative flex flex-col gap-3 pb-4 text-zinc-600 dark:text-zinc-200 md:col-span-3 leading-relaxed">
    {description && <p>{description}</p>}

    {normalizedHighlights.length > 0 && (
      <ul class="list-disc space-y-2 pl-5">
        {normalizedHighlights.map((highlight) => (
          <li>
            {highlight.text}
            {highlight.href && (
              <>
                {" "}
                <LinkInline href={highlight.href}>
                  {highlight.linkLabel ?? "Read publication"}
                </LinkInline>
              </>
            )}
          </li>
        ))}
      </ul>
    )}

    {techs.length > 0 && (
      <div class="flex flex-wrap gap-2 mt-2">
        {techs.map((tech) => (
          <TechPill label={tech} />
        ))}
      </div>
    )}

    {link && (
      <LinkInline href={link}>
        Know more
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="w-4 h-4"
          viewBox="0 0 24 24"
          stroke-width="2"
          stroke="currentColor"
          fill="none"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path stroke="none" d="M0 0h24v24H0z" />
          <path d="M9 6l6 6l-6 6" />
        </svg>
      </LinkInline>
    )}
  </div>
</div>
